/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include "zmk-nodefree-config/helper.h"
#include "zmk-nodefree-config/keypos_def/keypos_36keys.h"

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/mouse.h>
#include <dt-bindings/zmk/outputs.h>


#define KEYS_L LT0 LT1 LT2 LT3 LT4 LM0 LM1 LM2 LM3 LM4 LB0 LB1 LB2 LB3 LB4  /* left hand  */
#define KEYS_R RT0 RT1 RT2 RT3 RT4 RM0 RM1 RM2 RM3 RM4 RB0 RB1 RB2 RB3 RB4  /* right hand */
#define THUMBS LH2 LH1 LH0 RH0 RH1 RH2                                      /* thumbs     */

#define DEF 0
#define GAM 1
#define GAN 2
#define MED 3
#define NAV 4
#define MOU 5
#define SYM 6
#define NUM 7
#define FUN 8


// Combos

#undef COMBO_HOOK
#define COMBO_HOOK
#define COMBO_TERM_FAST 10
#define COMBO_TERM_SLOW 50

// CAPS WORD
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |XXXFXXX|   G   |   |   H   |XXXJXXX|   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |

&caps_word {
    continue-list = <UNDERSCORE MINUS>;
};

// REFRESH (F5)
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |XXXHXXX|XXXJXXX|   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(refr, &kp F5, RM0 RM1, DEF, COMBO_TERM_FAST)        

// PASTE
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   H   |   J   |   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |XXXVXXX|XXXBXXX|   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(paste, &kp LC(V), LB0 LB1, DEF, COMBO_TERM_SLOW)

// COPY
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   H   |   J   |   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |XXXCXXX|XXXVXXX|   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(copy, &kp LC(C), LB1 LB2, DEF, COMBO_TERM_SLOW)

// CUT
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   H   |   J   |   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |XXXXXXX|XXXCXXX|   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(cut, &kp LC(X), LB2 LB3, DEF, COMBO_TERM_SLOW)

// SELECT ALL
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |XXXAXXX|XXXSXXX|   D   |   F   |   G   |   |   H   |   J   |   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(sall, &kp LC(A), LM4 LM3, DEF, COMBO_TERM_FAST)

// UNDO
// -----------------------------------------------------------------------------------------
// tap      |   Q   |XXXWXXX|XXXEXXX|   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   H   |   J   |   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(undo, &kp LC(Z), LT2 LT3, DEF, COMBO_TERM_SLOW)

// REDO
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |XXXEXXX|XXXRXXX|   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   H   |   J   |   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(redo, &kp LC(Y), LT1 LT2, DEF, COMBO_TERM_SLOW)

// APOSTROPHE
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          ___________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   H   |   J   |   K   |XXXLXXX|XXX;XXX|
//          ___________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(apos, &kp APOS, RM3 RM4, DEF, COMBO_TERM_SLOW)

// CAPS WORD
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |XXXFXXX|   G   |   |   H   |XXXJXXX|   K   |   L   |   ;   |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
ZMK_COMBO(caps, &caps_word, LM1 RM1, DEF, COMBO_TERM_SLOW)


&mt{
        flavor = "balanced";
        tapping-term-ms = <350>;
        quick-tap-ms = <250>;
        require-prior-idle-ms = <150>;
};

&lt{
        quick-tap-ms = <250>;
};

/ {

        keymap {
                compatible = "zmk,keymap";

                default_layer {
                        display-name = "Base";
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   Y   |   U   |   I   |   O   |   P   |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   H   |   J   |   K   |   L   |   ;   |
// hold     |       |  ALT  | CTRL  | SHFT  |       |   |       | SHFT  | CTRL  |  ALT  |       |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   N   |   M   |   ,   |   .   |   /   |
// hold     |  GUI  |       |       |       |       |   |       |       |       |       |  GUI  |
//
// tap                      |  ESC  |  ENT  |  TAB  |   | BSPC  |  SPC  |  DEL  |
// hold  LAYER              | (GUI) | (NAV) | (MOU) |   | (SYM) | (NUM) | (FUN) |

                        bindings = <
&kp Q           &kp W           &kp E           &kp R             &kp T            &kp Y              &kp U              &kp I           &kp O            &kp P                    
&kp A           &mt LEFT_ALT S  &mt LCTRL D     &mt LEFT_SHIFT F  &kp G            &kp H              &mt RSHIFT J       &mt RCTRL K     &mt RIGHT_ALT L  &mt APOS SEMICOLON
&mt LEFT_GUI Z  &kp X           &kp C           &kp V             &kp B            &kp N              &kp M              &kp COMMA       &kp DOT          &mt RIGHT_GUI FSLH
                                &lt MED ESCAPE  &lt NAV ENTER     &lt MOU TAB      &lt SYM BACKSPACE  &lt NUM SPACE      &lt FUN DELETE
                        >;
                };

                gam_layer {
                        display-name = "Game";
// -----------------------------------------------------------------------------------------
// tap      |  TAB  |   Q   |   W   |   E   |   R   |   |   Y   |   U   |   I   |   O   |   P   |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   G   |   A   |   S   |   D   |   F   |   |   H   |   J   |   K   |   L   |   ;   |
// hold     | SHFT  |       |       |       |       |   |       | SHFT  | CTRL  |  ALT  |       |
//          _____________________________________________________________________________________
// tap      | CTRL  |   Z   |   X   |   C   |   V   |   |   N   |   M   |   ,   |   .   |   /   |
// hold     |       |  ALT  |       |       |       |   |       |       |       |       |  GUI  |
//
// tap                      |   M   |  ENT  |  SPC  |   | BSPC  |  SPC  |  DEL  |
// hold  LAYER              |  ESC  | (GAN) | (MOU) |   | (SYM) | (NUM) | (FUN) |

                        bindings = <
   &kp TAB       &kp Q           &kp W          &kp E          &kp R            &trans             &trans         &trans  &trans  &trans                   
   &mt LSHIFT G  &kp A           &kp S          &kp D          &kp F            &trans             &trans         &trans  &trans  &trans
   &kp LCTRL     &mt LEFT_ALT Z  &kp X          &kp C          &kp V            &trans             &trans         &trans  &trans  &trans
                                 &mt ESCAPE M   &lt GAN ENTER  &lt MOU SPACE    &lt SYM BACKSPACE  &lt NUM SPACE  &lt FUN DELETE
                        >;
                };
                gan_layer {
                        display-name = "Gnum";
// -----------------------------------------------------------------------------------------
// tap      |   1   |   2   |   3   |   4   |   5   |   |   6   |   7   |   8   |   9   |   0   |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   G   |   A   |   S   |   D   |   F   |   |   H   |   J   |   K   |   L   |   ;   |
// hold     | SHFT  |       |       |       |       |   |       | SHFT  | CTRL  |  ALT  |       |
//          _____________________________________________________________________________________
// tap      | CTRL  |   Z   |   X   |   C   |   V   |   |   N   |   M   |   ,   |   .   |   /   |
// hold     |       |  ALT  |       |       |       |   |       |       |       |       |  GUI  |
//
// tap                      |   M   |XXXXXXX|  SPC  |   | BSPC  |  SPC  |  DEL  |
// hold  LAYER              |  ESC  |XXXXXXX| (MOU) |   | (SYM) | (NUM) | (FUN) |

                        bindings = <
   &kp N1        &kp N2          &kp N3  &kp N4  &kp N5           &kp N6  &kp N7  &kp N8  &kp N9  &kp N0
   &mt LSHIFT G  &kp A           &kp S   &kp D   &kp F            &trans  &trans  &trans  &trans  &trans
   &kp LCTRL     &mt LEFT_ALT Z  &kp X   &kp C   &kp V            &trans  &trans  &trans  &trans  &trans
                                 &trans  &trans  &trans           &trans  &trans  &trans
                        >;
                };

                med_layer {
                        display-name = "Med";
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   |   R   |   M   |   H   |   S   |   V   |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   |   E   | PREV  | VOLD  | VOLU  | NEXT  |
// hold     |       |  ALT  | CTRL  | SHFT  |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |   O   |   0   |   1   |   2   |   3   |
// hold     |  GUI  |       |       |       |       |   |       |       |       |       |  GUI  |
//
// tap                      |XXXXXXX|  ENT  |  TAB  |   | PLAY  | STOP  | MUTE  |
// hold  LAYER              |XXXXXXX| (NAV) | (MOU) |   |       |       |       |

                        bindings = <
&trans  &trans  &trans  &trans  &trans         &kp R             &kp M           &kp H         &kp S            &kp V        
&trans  &trans  &trans  &trans  &trans         &kp E             &kp C_PREVIOUS  &kp C_VOL_DN  &kp C_VOLUME_UP  &kp K_NEXT   
&trans  &trans  &trans  &trans  &trans         &kp O             &kp N0          &kp N1        &kp N2           &kp N3
                &trans  &trans  &trans         &kp K_PLAY_PAUSE  &kp K_STOP      &kp K_MUTE
                        >;
                };

                nav_layer {
                        display-name = "Nav";
// -----------------------------------------------------------------------------------------
// tap      |   Q   |   W   |   E   |   R   |   T   |   | UNDO  |  CUT  | COPY  | PASTE | REDO  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   A   |   S   |   D   |   F   |   G   |   | CAPS  | HOME  |  UP   |  END  | PGUP  |
// hold     |       |  ALT  | CTRL  | SHFT  |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   Z   |   X   |   C   |   V   |   B   |   |  INS  | LEFT  | DOWN  | RGHT  | PGDN  |
// hold     |  GUI  |       |       |       |       |   |       |       |       |       |       |
//
// tap                      |  ESC  |XXXXXXX|  TAB  |   | BSPC  |  SPC  |  DEL  |
// hold  LAYER              | (GUI) |XXXXXXX| (MOU) |   | (SYM) | (NUM) | (FUN) |

                        bindings = <
&trans  &trans  &trans  &trans  &trans    &kp LC(Z)     &kp LC(X)  &kp LC(C)     &kp LC(V)    &kp LC(Y)    
&trans  &trans  &trans  &trans  &trans    &kp CAPSLOCK  &kp HOME   &kp UP_ARROW  &kp END      &kp PAGE_UP   
&trans  &trans  &trans  &trans  &trans    &kp INSERT    &kp LEFT   &kp DOWN      &kp RIGHT    &kp PAGE_DOWN
                &trans  &trans  &trans    &trans        &trans     &trans
                        >;
                };

// This layer is unreachable until "tri layer state" is sorted out.
// Leaving it here for completeness.
                mou_layer {
                        display-name = "Mou";
// -----------------------------------------------------------------------------------------
// tap      | UNDO  |  CUT  | COPY  | PASTE | REDO  |   | UNDO  |  CUT  | COPY  | PASTE | REDO  |
// hold     |       |       |       |       | PRTSC |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      | LEFT  | LCLK  |       | RCLK  | PGUP  |   | LEFT  | LCLK  |       | RCLK  | PGUP  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      | RGHT  |       |       |       | PGDN  |   | RGHT  |       |       |       | PGDN  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//
// tap                      |  ESC  |  ENT  |XXXXXXX|   | LCLK  | MCLK  | RCLK  |
// hold  LAYER              | [DEF] | [GAM] |XXXXXXX|   |       |       |       |

                        bindings = <
&kp LC(Z)  &kp LC(X)  &kp LC(C)  &kp LC(V)  &mt PRINTSCREEN LC(Y)     &kp LC(Z)  &kp LC(X)  &kp LC(C)  &kp LC(V)  &kp LC(Y)  
&kp LEFT   &mkp LCLK  &trans     &mkp RCLK  &kp PAGE_UP               &kp LEFT   &mkp LCLK  &trans     &mkp RCLK  &kp PAGE_UP      
&kp RIGHT  &trans     &trans     &trans     &kp PAGE_DOWN             &kp RIGHT  &trans     &trans     &trans     &kp PAGE_DOWN   
                      &to DEF    &to GAM    &trans                    &mkp LCLK  &mkp MCLK  &mkp MB2
                        >;
                };
                sym_layer {
                        display-name = "Sym";
// -----------------------------------------------------------------------------------------
// tap      |   {   |   &   |   *   |   (   |   }   |   | UNDO  |  CUT  | COPY  | PASTE | REDO  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   :   |   $   |   %   |   ^   |   +   |   | LEFT  | LCLK  |       | RCLK  | PGUP  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   ~   |   !   |   @   |   #   |   |   |   | RGHT  |       |       |       | PGDN  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//
// tap                      |   (   |   )   |   _   |   |XXXXXXX|  SPC  |  DEL  |
// hold  LAYER              |       |       |       |   |XXXXXXX| (NUM) | (FUN) |

                        bindings = <
&kp LEFT_BRACE  &kp AMPS  &kp STAR              &kp LEFT_PARENTHESIS   &kp RIGHT_BRACE    &trans  &trans  &trans  &trans  &trans 
&kp COLON       &kp DLLR  &kp PERCENT           &kp CARET              &kp PLUS           &trans  &trans  &trans  &trans  &trans 
&kp TILDE       &kp EXCL  &kp AT                &kp HASH               &kp PIPE           &trans  &trans  &trans  &trans  &trans 
                          &kp LEFT_PARENTHESIS  &kp RIGHT_PARENTHESIS  &kp UNDER          &trans  &trans  &trans
                        >;
                };

                num_layer {
                        display-name = "Num";
// -----------------------------------------------------------------------------------------
// tap      |   [   |   7   |   8   |   9   |   ]   |   |   +   |   7   |   8   |   9   |   *   |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   ;   |   4   |   5   |   6   |   =   |   |   -   |   4   |   5   |   6   |   /   |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |   `   |   1   |   2   |   3   |   \   |   |   0   |   1   |   2   |   3   |   /   |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//
// tap                      |   .   |   0   |   -   |   | BSPC  |XXXXXXX|  DEL  |
// hold  LAYER              |       |       |       |   | (SYM) |XXXXXXX| (FUN) |

                        bindings = <
&kp LEFT_BRACKET  &kp N7  &kp N8      &kp N9  &kp RIGHT_BRACKET    &kp PLUS   &kp N7  &kp N8  &kp N9  &kp STAR      
&kp SEMICOLON     &kp N4  &kp N5      &kp N6  &kp EQUAL            &kp MINUS  &kp N4  &kp N5  &kp N6  &kp SLASH 
&kp GRAVE         &kp N1  &kp N2      &kp N3  &kp BACKSLASH        &kp N0     &kp N1  &kp N2  &kp N3  &trans         
                          &kp PERIOD  &kp N0  &kp MINUS            &trans     &trans  &trans
                        >;
                };

                fun_layer {
                        display-name = "Fun";
// -----------------------------------------------------------------------------------------
// tap      |  F12  |  F7   |  F8   |  F9   | PSCR  |   |  BT0  |  BT1  |  BT2  |  BT3  |  BT4  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |  F11  |  F4   |  F5   |  F6   | SCRLK |   | DCN0  | DCN1  | DCN2  | DCN3  | DCN4  |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//          _____________________________________________________________________________________
// tap      |  F10  |  F1   |  F2   |  F3   | PAUSE |   |  BLE  |  USB  |   ,   | BTCLA | BTCLR |
// hold     |       |       |       |       |       |   |       |       |       |       |       |
//
// tap                      | [DEF] | [GAM] |  TAB  |   | BSPC  |  SPC  |XXXXXXX|
// hold  LAYER              |       |       | (MOU) |   | (SYM) | (NUM) |XXXXXXX|

                        bindings = <
&kp F12  &kp F7  &kp F8    &kp F9    &kp PRINTSCREEN    &bt BT_SEL 0   &bt BT_SEL 1   &bt BT_SEL 2   &bt BT_SEL 3    &bt BT_SEL 4   
&kp F11  &kp F4  &kp F5    &kp F6    &kp SCROLLLOCK     &bt BT_DISC 0  &bt BT_DISC 1  &bt BT_DISC 2  &bt BT_DISC 3   &bt BT_DISC 4  
&kp F10  &kp F1  &kp F2    &kp F3    &kp PAUSE_BREAK    &out OUT_BLE   &out OUT_USB   &trans         &bt BT_CLR_ALL  &bt BT_CLR     
                 &to DEF   &to GAM   &trans             &trans         &trans         &trans
                        >;
                };

        };
};    

